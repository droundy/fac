image: rust

build:
  stage: build
  script:
    - sudo apt-get update
    - sudo apt-get install python3-markdown ruby-sass help2man
    - cargo build
    - target/debug/fac
  artifacts:
    paths:
      - fac

# run tests
test:
  stage: test
  before_script:
    - git config --global user.email "testing-on-gitlab-ci@example.com"
    - git config --global user.name "CI Builder"
    - mkdir -p ~/.cargo/bin
    - export PATH=~/.cargo/bin:$PATH
  script:
    - python3 run-tests.py -v
  artifacts:
    paths:
      - web

pages:
  stage: deploy
  script:
    - cargo build
    - target/debug/fac
    - cat .fac
    - ./fac web/index.html web/fac-latest.deb web/style.css
    - ./fac
    - mv web public
  artifacts:
    paths:
      - public
